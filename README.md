# sort_excel（改良版）

Excelファイルの「受諾確認票」シートを読み込み、用途別に整形・並べ替え・書式設定を行って出力します。  
本版は **バッチファイル不要**・**PyInstallerでexe化** を前提とした配布が可能です。


## できること

1. **並べ替えシートの自動作成**
   - `sorted_by_融資実行日` … 融資実行日で昇順
   - `sorted_by_金消日・面談日` … 金消日・面談日で昇順
   - `統合データ` … 上記を統合し、`日付` 昇順
   - **日付ごとシート** … `統合データ`を日付で分割して自動生成

2. **日付シートの並べ替えルール**
   1) `識別`: 降順  
   2) `担当`: 次の順序で昇順（**未掲載名は最後**）  
      `河内，岩川，杉田，正木，吉田，脇本，中本，椙村，北条，上野`  
   3) `時間`: 昇順（`HH:MM` 等の文字列を可能な限り解釈）

3. **表の書式設定**
   - **縮小して全体を表示（Shrink-to-fit）**
   - **罫線**: すべてのセルの外枠・内枠を**点線（dotted）**で付与
   - **行の高さ**: `25`、**上下中央揃え**
   - **列幅**:  
     - `お客様氏名`: **115 px**  
     - `物件`: **160 px**  
     - `場所`: **160 px**  
     - **その他の列**: **80 px**  
     ※Excel内部の列幅単位へ近似換算して設定します。


## 使い方（Pythonで実行）

```bash
python sort_excel.py <Excelファイルパス>
# 出力: sorted_combined.xlsx（同フォルダ）
```

- 入力ブックは **「受諾確認票」** というシート名が必要です。
- 主要列は次を想定しています（余分な列があってもOK）:
  - `融資実行日`, `金消日・面談日`（日付）
  - `形態`, `お客様氏名`, `物件`, `依頼内容`, `担当`, `管轄`
  - `立会時間`, `立会場所`, `立会者`, `当日申請`
  - `金消時間`, `金消場所・面談場所`, `意思確認`


## 配布用 exe の作り方（PyInstaller）

1. 依存ライブラリをインストール（作成者PCのみ）
   ```bash
   pip install pandas openpyxl pyinstaller
   ```

2. ワンファイルexeを作成
   ```bash
   pyinstaller --onefile --name sort_excel sort_excel.py
   ```

3. `dist/sort_excel.exe` を配布  
   以降、**Pythonが入っていないPCでも**以下のように使えます：
   ```cmd
   sort_excel.exe C:\path\to\入力.xlsx
   ```

> 既存のバッチファイル（.bat）は不要です。exeに直接ファイルをドラッグ＆ドロップしても実行できます。


## 出力内容

- `sorted_by_融資実行日`
- `sorted_by_金消日・面談日`
- `統合データ`
- **各日付シート（例: 2025-09-11）** … ルール(識別↓→担当（指定順）→時間↑)でソート済み

すべてのシートに対して、**縮小表示・点線罫線・行高25・中央揃え・列幅設定**が適用されます。

## トラブルシューティング

- **「受諾確認票」シートが見つからない**  
  → 入力ブックの対象シート名を確認してください。

- **時間の列がうまく並ばない**  
  → `HH:MM` や `H:MM:SS` 形式の文字列であれば自動解釈します。判別できない書式は末尾になる場合があります。

- **列幅のpx指定が反映されない/微妙にずれる**  
  → Excelの内部単位の都合上、**おおよその幅**になります（フォントや環境により差異あり）。


## 変更点（旧版から）

- バッチ運用を廃止し、**PyInstallerでexe化**可能にしました。
- **日付シート内の並べ替えルール**を追加（識別↓→担当（カスタム順）→時間↑）。
- **表の書式設定**（縮小・罫線・高さ・中央揃え・列幅）を全シートに自動適用。


## ライセンス

MIT License
